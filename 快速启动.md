# å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸš€ ä¸€é”®å¯åŠ¨æ­¥éª¤

### ç»ˆç«¯ 1: å¯åŠ¨ Prefect Server

```bash
cd /root/docker-soft/dify/01-difyè¿ç»´ç›‘æ§
uv run prefect server start
```

**ä¿æŒè¿è¡Œï¼**

### ç»ˆç«¯ 2: è®¾ç½®ç¯å¢ƒå¹¶å¯åŠ¨ Worker

```bash
cd /root/docker-soft/dify/01-difyè¿ç»´ç›‘æ§

# æ–¹å¼ 1: ä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰
chmod +x scripts/setup_prefect.sh
./scripts/setup_prefect.sh

# æ–¹å¼ 2: æ‰‹åŠ¨è®¾ç½®
uv run prefect config set PREFECT_API_URL=http://127.0.0.1:4200/api
uv run prefect work-pool create dify-workflow-pool --type process

# å¯åŠ¨ Worker
uv run prefect worker start --pool dify-workflow-pool
```

**ä¿æŒè¿è¡Œï¼**

### ç»ˆç«¯ 3: éƒ¨ç½²ä»»åŠ¡ï¼ˆä¿æŒè¿è¡Œï¼‰

```bash
cd /root/docker-soft/dify/01-difyè¿ç»´ç›‘æ§

# éƒ¨ç½²æ¯æ—¥æŠ¥å‘Šï¼ˆæ¯30ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œç”¨äºæµ‹è¯•ï¼‰
# æ³¨æ„ï¼šserve() æ–¹æ³•ä¼šæŒç»­è¿è¡Œï¼Œéœ€è¦ä¿æŒæ­¤ç»ˆç«¯çª—å£æ‰“å¼€
uv run python deployments/daily_report.py
```

**ä¿æŒæ­¤ç»ˆç«¯çª—å£è¿è¡Œï¼** è¿™ä¼šæŒç»­è¿è¡Œå¹¶è‡ªåŠ¨å¤„ç†è°ƒåº¦ã€‚

å¦‚æœéœ€è¦éƒ¨ç½²æ¯å‘¨æŠ¥å‘Šï¼Œå¯ä»¥åœ¨**ç¬¬å››ä¸ªç»ˆç«¯çª—å£**è¿è¡Œï¼š

```bash
cd /root/docker-soft/dify/01-difyè¿ç»´ç›‘æ§
uv run python deployments/weekly_report.py
```

## âœ… éªŒè¯å®šæ—¶ä»»åŠ¡

### æ–¹æ³• 1: ä½¿ç”¨éªŒè¯è„šæœ¬ï¼ˆæœ€å¿«ï¼‰

```bash
./scripts/verify.sh
```

### æ–¹æ³• 2: è®¿é—® Prefect UI

æ‰“å¼€æµè§ˆå™¨ï¼šhttp://127.0.0.1:4200

1. ç‚¹å‡»å·¦ä¾§ **"Deployments"** - åº”è¯¥çœ‹åˆ°ä¸¤ä¸ªéƒ¨ç½²
2. ç‚¹å‡»å·¦ä¾§ **"Flow Runs"** - ç­‰å¾…30ç§’ååº”è¯¥çœ‹åˆ°æ–°çš„è¿è¡Œè®°å½•
3. ç‚¹å‡»è¿è¡Œè®°å½•æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

### æ–¹æ³• 3: å‘½ä»¤è¡ŒéªŒè¯

```bash
# æŸ¥çœ‹éƒ¨ç½²
uv run prefect deployment ls

# æŸ¥çœ‹è¿è¡Œè®°å½•
uv run prefect flow-run ls --limit 10

# æ‰‹åŠ¨è§¦å‘æµ‹è¯•
uv run prefect deployment run "fetch-workflow-logs-flow/daily-workflow-report-debug"
```

## ğŸ“Š é¢„æœŸç»“æœ

- âœ… Prefect Server è¿è¡Œåœ¨ http://127.0.0.1:4200
- âœ… Worker æ­£åœ¨è¿è¡Œå¹¶è¿æ¥åˆ° Work Pool
- âœ… 2ä¸ª Deployment å·²åˆ›å»º
- âœ… æ¯30ç§’è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ï¼ˆæ¯æ—¥æŠ¥å‘Šï¼‰
- âœ… è¾“å‡ºæ–‡ä»¶ç”Ÿæˆåœ¨ `outputs/reports/daily/`

## ğŸ§ª æµ‹è¯•æ–¹æ³•ï¼ˆä¸è§¦å‘å®šæ—¶ä»»åŠ¡ï¼‰

### æ–¹æ³• 1: ç›´æ¥è¿è¡Œæµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼Œæœ€ç®€å•ï¼‰

ä¸éœ€è¦å¯åŠ¨ Prefect Server å’Œ Workerï¼Œç›´æ¥æµ‹è¯•ä»£ç é€»è¾‘ï¼š

```bash
cd /root/docker-soft/dify/01-difyè¿ç»´ç›‘æ§

# è¿è¡Œæµ‹è¯•è„šæœ¬
uv run python test_flow.py
```

è¿™ä¼šï¼š
- ç›´æ¥è°ƒç”¨ Flow å‡½æ•°
- ä¸è§¦å‘å®šæ—¶ä»»åŠ¡
- ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šåˆ° `outputs/reports/test/`
- æ˜¾ç¤ºè¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—

### æ–¹æ³• 2: æ‰‹åŠ¨è§¦å‘å·²éƒ¨ç½²çš„ä»»åŠ¡

å¦‚æœå·²ç»éƒ¨ç½²äº†ä»»åŠ¡ï¼Œå¯ä»¥æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡ï¼š

```bash
# æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡è¿è¡Œï¼ˆä¸ç­‰å¾…å®šæ—¶ï¼‰
uv run prefect deployment run "fetch-workflow-logs-flow/daily-workflow-report-debug"

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
uv run prefect flow-run ls --limit 1
```

### æ–¹æ³• 3: åœ¨ Python ä¸­ç›´æ¥è°ƒç”¨

```python
from src.flows.workflow_log_flow import fetch_workflow_logs_flow

# ç›´æ¥è°ƒç”¨ï¼Œä¸é€šè¿‡ Prefect è°ƒåº¦
result = fetch_workflow_logs_flow(
    base_url="http://localhost",
    api_token="app-R7kB8EZhzg4R8o2Li6FA4Dgb",
    app_id="5ac73990-ee17-4aba-993c-a473e2fa2a90",
    output_format="csv",
    output_dir="./outputs/reports/test",
    fetch_all=True,
    with_details=True,
    with_node_executions=True,
    limit=20,  # é™åˆ¶æ•°é‡ï¼ŒåŠ å¿«æµ‹è¯•
    max_pages=5,  # æœ€å¤š5é¡µ
)
print(f"æµ‹è¯•å®Œæˆï¼Œè·å– {len(result.get('data', []))} æ¡æ—¥å¿—")
```

## ğŸ› é‡åˆ°é—®é¢˜ï¼Ÿ

æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š[å¯åŠ¨å’ŒéªŒè¯æŒ‡å—.md](./å¯åŠ¨å’ŒéªŒè¯æŒ‡å—.md)
